/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __export = (target, all) => {
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __copyProps = (to, from, except, desc) => {
  if (from && typeof from === "object" || typeof from === "function") {
    for (let key of __getOwnPropNames(from))
      if (!__hasOwnProp.call(to, key) && key !== except)
        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });
  }
  return to;
};
var __toCommonJS = (mod) => __copyProps(__defProp({}, "__esModule", { value: true }), mod);

// main.ts
var main_exports = {};
__export(main_exports, {
  default: () => ContentLinkerPlugin
});
module.exports = __toCommonJS(main_exports);
var import_obsidian = require("obsidian");
var ContentLinkerPlugin = class extends import_obsidian.Plugin {
  /**
   * Plugin onload event handler.
   */
  async onload() {
    await this.loadSettings();
    console.log("Loading Content Linker plugin");
    this.addCommand({
      id: "search-possible-bi-directional-links",
      name: "Search possible bi-directional links in vault",
      callback: async () => {
        await this.searchPossibleBiLinks();
        await this.saveSettings();
      }
    });
    this.addSettingTab(new ContentLinkerSettingTab(this.app, this));
  }
  /**
   * Load plugin data from storage.
   */
  async loadSettings() {
    this.settings = Object.assign(
      {},
      {
        biLinks: [],
        optionsCount: 10,
        ignoredContent: [],
        relativePathOfExcludedNotes: ""
      },
      await this.loadData()
    );
  }
  /**
   * Save plugin data to storage.
   */
  async saveSettings() {
    this.saveData(this.settings);
  }
  /**
   * Search for possible bi-links in the vault.
   */
  async searchPossibleBiLinks() {
    const vault = this.app.vault;
    const notes = this.settings.relativePathOfExcludedNotes === "" ? vault.getMarkdownFiles() : vault.getMarkdownFiles().filter((file) => !file.path.includes(this.settings.relativePathOfExcludedNotes.toString()));
    const existingBiLinks = /* @__PURE__ */ new Set();
    for (const note of notes) {
      const content = await vault.cachedRead(note);
      const biLinkKeywords = content.match(/\[\[(.+?)\]\]/g) || [];
      for (const biLink of biLinkKeywords) {
        const keyword = biLink.slice(2, -2);
        existingBiLinks.add(keyword);
      }
    }
    const potentialBiLinks = /* @__PURE__ */ new Map();
    for (const note of notes) {
      const content = await vault.cachedRead(note);
      const uniqueKeywords = content.match(/\b\w+\b/g) || [];
      for (const keyword of uniqueKeywords) {
        if (!potentialBiLinks.has(keyword) && !this.settings.biLinks.some((biLink) => biLink.keyword === keyword) && !existingBiLinks.has(keyword) && !content.includes(`[[${keyword}]]`) && !this.settings.ignoredContent.some(
          (ignoredContent) => ignoredContent.keyword === keyword
        )) {
          potentialBiLinks.set(keyword, 1);
        } else {
          potentialBiLinks.set(
            keyword,
            (potentialBiLinks.get(keyword) || 0) + 1
          );
        }
      }
    }
    this.settings.biLinks = Array.from(potentialBiLinks.entries()).map(
      ([keyword, count]) => ({
        keyword,
        count,
        isSelected: false
      })
    );
    await this.saveSettings();
    new import_obsidian.Notice("Search finished!");
  }
};
var ContentLinkerSettingTab = class extends import_obsidian.PluginSettingTab {
  constructor(app, plugin) {
    super(app, plugin);
    this.plugin = plugin;
  }
  async display() {
    const { containerEl } = this;
    containerEl.empty();
    const relativePathExclusion = new import_obsidian.Setting(containerEl).setName("Relative path of excluded notes").setDesc("Enter a relative path:");
    relativePathExclusion.addText((input) => input.setPlaceholder("Relative path of exluded notes").setValue(this.plugin.settings.relativePathOfExcludedNotes.toString()).onChange(async (value) => {
      this.plugin.settings.relativePathOfExcludedNotes = value;
      await this.plugin.saveSettings();
    }));
    const searchButton = containerEl.createEl("button", {
      text: "Search possible bi-directional links in vault"
    });
    searchButton.addEventListener("click", async () => {
      await this.plugin.searchPossibleBiLinks();
      this.display();
    });
    new import_obsidian.Setting(containerEl).setName("Possible bi-directional content").setDesc("Enter a number:").addText(
      (text) => text.setValue(this.plugin.settings.optionsCount.toString()).onChange(async (value) => {
        const parsedValue = parseFloat(value);
        if (!isNaN(parsedValue)) {
          this.plugin.settings.optionsCount = parsedValue;
        }
      })
    );
    const countButton = containerEl.createEl("button", {
      text: "Update number of search results"
    });
    countButton.addEventListener("click", async () => {
      await this.plugin.searchPossibleBiLinks();
      this.display();
    });
    const table = containerEl.createEl("table", { cls: "content-linker-table" });
    const thead = table.createTHead();
    const headerRow = thead.insertRow();
    headerRow.insertCell().textContent = "No.";
    headerRow.insertCell().textContent = "Count";
    headerRow.insertCell().textContent = "Keyword";
    headerRow.insertCell().textContent = "Selected";
    const sortedBiLinks = this.plugin.settings.biLinks.sort((a, b) => b.count - a.count).slice(0, this.plugin.settings.optionsCount);
    const tbody = table.createTBody();
    for (let index = 0; index < sortedBiLinks.length; index++) {
      const { keyword, count, isSelected } = sortedBiLinks[index];
      const isAlreadyBiLink = await this.isAlreadyBiLink(keyword);
      if (!isAlreadyBiLink && !this.isIgnored(keyword)) {
        const row = tbody.insertRow();
        row.insertCell().textContent = (index + 1).toString();
        row.insertCell().textContent = count.toString();
        row.insertCell().textContent = keyword;
        row.insertCell().appendChild(this.createCheckbox(keyword, isSelected));
      }
    }
    const updateButton = containerEl.createEl("button", {
      text: "Update bi-directional link for selected option(s)"
    });
    updateButton.addEventListener("click", async () => {
      await this.updateBiLinks();
      await this.plugin.searchPossibleBiLinks();
      this.display();
    });
    const ignoreButton = containerEl.createEl("button", {
      text: "Ignore selected option(s)"
    });
    ignoreButton.addEventListener("click", async () => {
      await this.ignoreSelectedOptions();
    });
    this.displayIgnoredContentList();
  }
  /**
   * Check if a keyword is ignored.
   * @param keyword - The keyword to check.
   * @returns True if ignored, false otherwise.
   */
  isIgnored(keyword) {
    return this.plugin.settings.ignoredContent.some(
      (ignoredContent) => ignoredContent.keyword === keyword
    );
  }
  /**
   * Check if a keyword is already a bi-link in any note.
   * @param keyword - The keyword to check.
   * @returns True if it is already a bi-link, false otherwise.
   */
  async isAlreadyBiLink(keyword) {
    const vault = this.plugin.app.vault;
    const notes = vault.getMarkdownFiles();
    for (const note of notes) {
      const content = await vault.cachedRead(note);
      const regex = new RegExp(`\\[\\[${keyword}\\]\\]`, "g");
      if (content.match(regex)) {
        return true;
      }
    }
    return false;
  }
  /**
   * Create a checkbox element for a bi-link option.
   * @param keyword - The keyword for the bi-link.
   * @param checked - Whether the checkbox is selected.
   * @returns The created checkbox element.
   */
  createCheckbox(keyword, checked) {
    const checkboxContainer = document.createElement("label");
    const checkbox = document.createElement("input");
    checkbox.type = "checkbox";
    checkbox.checked = checked;
    checkboxContainer.appendChild(checkbox);
    checkbox.addEventListener("change", async () => {
      this.plugin.settings.biLinks = this.plugin.settings.biLinks.map(
        (biLink) => biLink.keyword === keyword ? { ...biLink, isSelected: checkbox.checked } : biLink
      );
      await this.plugin.saveSettings();
    });
    return checkboxContainer;
  }
  async updateBiLinks() {
    const selectedBiLinks = this.plugin.settings.biLinks.filter(
      (biLink) => biLink.isSelected
    );
    this.plugin.settings.biLinks = this.plugin.settings.biLinks.map(
      (biLink) => selectedBiLinks.some(({ keyword }) => biLink.keyword === keyword) ? { ...biLink, isSelected: false } : biLink
    );
    let progressNotice = new import_obsidian.Notice("Updating: 0 of 0");
    const updateProgressNotice = (current, total) => {
      const message = `Updating: ${current} of ${total}`;
      progressNotice.setMessage(message);
    };
    await new Promise((resolve) => {
      const delay = (ms) => new Promise((res) => setTimeout(res, ms));
      const updateLoop = async () => {
        const vault = this.plugin.app.vault;
        const notes = vault.getMarkdownFiles();
        const totalNotes = notes.length;
        let i = 0;
        for (const selectedBiLink of selectedBiLinks) {
          const { keyword } = selectedBiLink;
          for (const note of notes) {
            if (!this.isExcluded(note.path)) {
              let content = await vault.read(note);
              const regex = new RegExp(
                `\\b${keyword.replace(/[-/\\^$*+?.()|[\]{}]/g, "\\$&")}\\b`,
                "g"
              );
              content = content.replace(regex, `[[${keyword}]]`);
              await vault.modify(note, content);
              i++;
              updateProgressNotice(i, totalNotes);
              await delay(1);
              if (i % 100 == 0) {
                setTimeout(() => {
                  new import_obsidian.Notice(progressNotice.noticeEl.getText());
                }, 3e3);
              }
            }
          }
        }
        resolve();
      };
      updateLoop();
    });
    progressNotice.hide();
    await this.plugin.saveSettings();
    new import_obsidian.Notice("Update finished!");
  }
  /**
   * Check if a note path is excluded.
   * @param path - The path of the note.
   * @returns True if the note path is excluded, false otherwise.
   */
  isExcluded(path) {
    if (this.plugin.settings.relativePathOfExcludedNotes === "")
      return false;
    return path.includes(this.plugin.settings.relativePathOfExcludedNotes.toString());
  }
  /**
   * Ignore the selected bi-link options.
   */
  async ignoreSelectedOptions() {
    const selectedOptions = this.plugin.settings.biLinks.filter(
      (biLink) => biLink.isSelected
    );
    for (const selectedOption of selectedOptions) {
      const { keyword } = selectedOption;
      selectedOption.isSelected = false;
      if (!this.plugin.settings.ignoredContent.some(
        (ignoredContent) => ignoredContent.keyword === keyword
      )) {
        this.plugin.settings.ignoredContent.push(selectedOption);
      }
    }
    this.plugin.settings.biLinks = this.plugin.settings.biLinks.filter(
      (biLink) => !biLink.isSelected
    );
    await this.plugin.saveSettings();
    await this.plugin.searchPossibleBiLinks();
    this.display();
  }
  /**
   * Display the ignored content list.
   */
  async displayIgnoredContentList() {
    const { containerEl } = this;
    const ignoredContentSetting = new import_obsidian.Setting(containerEl).setName("Ignored content list").setDesc("Keywords that you want to ignore");
    const ignoredContentTable = containerEl.createEl("table", {
      cls: "content-linker-ignored-content-table"
    });
    const ignoredContentThead = ignoredContentTable.createTHead();
    const ignoredContentHeaderRow = ignoredContentThead.insertRow();
    ignoredContentHeaderRow.insertCell().textContent = "No.";
    ignoredContentHeaderRow.insertCell().textContent = "Count";
    ignoredContentHeaderRow.insertCell().textContent = "Keyword";
    ignoredContentHeaderRow.insertCell().textContent = "Selected";
    const sortedIgnoredList = this.plugin.settings.ignoredContent.sort(
      (a, b) => b.count - a.count
    );
    const ignoredContentTbody = ignoredContentTable.createTBody();
    for (let i = 0; i < sortedIgnoredList.length; i++) {
      const { keyword, count, isSelected } = sortedIgnoredList[i];
      const row = ignoredContentTbody.insertRow();
      row.insertCell(0).textContent = (i + 1).toString();
      row.insertCell(1).textContent = count ? count.toString() : "";
      row.insertCell(2).textContent = keyword;
      row.insertCell(3).appendChild(
        this.createIgnoredCheckbox(keyword, isSelected)
      );
    }
    containerEl.appendChild(ignoredContentTable);
    const removeButton = containerEl.createEl("button", {
      text: "Remove selected option(s) from ignored content list"
    });
    removeButton.addEventListener("click", async () => {
      this.removeFromIgnoredList();
    });
  }
  /**
   * Create a checkbox element for an ignored option.
   * @param keyword - The keyword for the ignored option.
   * @param checked - Whether the checkbox is selected.
   * @returns The created checkbox element.
   */
  createIgnoredCheckbox(keyword, checked) {
    const checkboxContainer = document.createElement("label");
    const checkbox = document.createElement("input");
    checkbox.type = "checkbox";
    checkbox.checked = checked;
    checkboxContainer.appendChild(checkbox);
    checkbox.addEventListener("change", async () => {
      this.plugin.settings.ignoredContent = this.plugin.settings.ignoredContent.map(
        (ignoredContent) => ignoredContent.keyword === keyword ? { ...ignoredContent, isSelected: checkbox.checked } : ignoredContent
      );
      await this.plugin.saveSettings();
    });
    return checkboxContainer;
  }
  /**
   * Remove the selected options from the ignored content list.
   */
  async removeFromIgnoredList() {
    const selectedIgnoredOptions = this.plugin.settings.ignoredContent.filter(
      (ignoredContent) => {
        return ignoredContent.isSelected;
      }
    );
    for (const selectedIgnoredOption of selectedIgnoredOptions) {
      const { keyword } = selectedIgnoredOption;
      const index = this.plugin.settings.ignoredContent.findIndex(
        (ignoredContent) => ignoredContent.keyword === keyword
      );
      if (index !== -1) {
        this.plugin.settings.ignoredContent.splice(index, 1);
      }
    }
    await this.plugin.saveSettings();
    this.display();
  }
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsibWFpbi50cyJdLAogICJzb3VyY2VzQ29udGVudCI6IFsiaW1wb3J0IHsgQXBwLCBOb3RpY2UsIFBsdWdpbiwgUGx1Z2luU2V0dGluZ1RhYiwgU2V0dGluZyB9IGZyb20gJ29ic2lkaWFuJztcclxuXHJcbmludGVyZmFjZSBCaUxpbmsge1xyXG4gIGtleXdvcmQ6IHN0cmluZztcclxuICBjb3VudDogbnVtYmVyO1xyXG4gIGlzU2VsZWN0ZWQ6IGJvb2xlYW47XHJcbn1cclxuXHJcbmludGVyZmFjZSBJZ25vcmVkQ29udGVudCB7XHJcbiAga2V5d29yZDogc3RyaW5nO1xyXG4gIGNvdW50OiBudW1iZXI7XHJcbiAgaXNTZWxlY3RlZDogYm9vbGVhbjtcclxufVxyXG5cclxuaW50ZXJmYWNlIENvbnRlbnRMaW5rZXJQbHVnaW5TZXR0aW5ncyB7XHJcbiAgYmlMaW5rczogQmlMaW5rW107XHJcbiAgb3B0aW9uc0NvdW50OiBudW1iZXI7XHJcbiAgaWdub3JlZENvbnRlbnQ6IElnbm9yZWRDb250ZW50W107XHJcbiAgcmVsYXRpdmVQYXRoT2ZFeGNsdWRlZE5vdGVzOiBzdHJpbmc7XHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIENvbnRlbnRMaW5rZXJQbHVnaW4gZXh0ZW5kcyBQbHVnaW4ge1xyXG5cclxuICBzZXR0aW5nczogQ29udGVudExpbmtlclBsdWdpblNldHRpbmdzO1xyXG5cclxuICAvKipcclxuICAgKiBQbHVnaW4gb25sb2FkIGV2ZW50IGhhbmRsZXIuXHJcbiAgICovXHJcbiAgYXN5bmMgb25sb2FkKCkge1xyXG4gICAgYXdhaXQgdGhpcy5sb2FkU2V0dGluZ3MoKTtcclxuXHJcbiAgICBjb25zb2xlLmxvZygnTG9hZGluZyBDb250ZW50IExpbmtlciBwbHVnaW4nKTtcclxuXHJcbiAgICB0aGlzLmFkZENvbW1hbmQoe1xyXG4gICAgICBpZDogJ3NlYXJjaC1wb3NzaWJsZS1iaS1kaXJlY3Rpb25hbC1saW5rcycsXHJcbiAgICAgIG5hbWU6ICdTZWFyY2ggcG9zc2libGUgYmktZGlyZWN0aW9uYWwgbGlua3MgaW4gdmF1bHQnLFxyXG4gICAgICBjYWxsYmFjazogYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgIGF3YWl0IHRoaXMuc2VhcmNoUG9zc2libGVCaUxpbmtzKCk7XHJcbiAgICAgICAgYXdhaXQgdGhpcy5zYXZlU2V0dGluZ3MoKTsgLy8gU2F2ZSBkYXRhIGFmdGVyIG1ha2luZyBjaGFuZ2VzXHJcbiAgICAgIH0sXHJcbiAgICB9KTtcclxuXHJcbiAgICB0aGlzLmFkZFNldHRpbmdUYWIobmV3IENvbnRlbnRMaW5rZXJTZXR0aW5nVGFiKHRoaXMuYXBwLCB0aGlzKSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBMb2FkIHBsdWdpbiBkYXRhIGZyb20gc3RvcmFnZS5cclxuICAgKi9cclxuICBhc3luYyBsb2FkU2V0dGluZ3MoKSB7XHJcbiAgICB0aGlzLnNldHRpbmdzID0gT2JqZWN0LmFzc2lnbihcclxuICAgICAge30sXHJcbiAgICAgIHtcclxuICAgICAgICBiaUxpbmtzOiBbXSxcclxuICAgICAgICBvcHRpb25zQ291bnQ6IDEwLFxyXG4gICAgICAgIGlnbm9yZWRDb250ZW50OiBbXSxcclxuICAgICAgICByZWxhdGl2ZVBhdGhPZkV4Y2x1ZGVkTm90ZXM6ICcnLFxyXG4gICAgICB9LFxyXG4gICAgICBhd2FpdCB0aGlzLmxvYWREYXRhKClcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBTYXZlIHBsdWdpbiBkYXRhIHRvIHN0b3JhZ2UuXHJcbiAgICovXHJcbiAgYXN5bmMgc2F2ZVNldHRpbmdzKCkge1xyXG4gICAgdGhpcy5zYXZlRGF0YSh0aGlzLnNldHRpbmdzKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFNlYXJjaCBmb3IgcG9zc2libGUgYmktbGlua3MgaW4gdGhlIHZhdWx0LlxyXG4gICAqL1xyXG4gIGFzeW5jIHNlYXJjaFBvc3NpYmxlQmlMaW5rcygpIHtcclxuICAgIGNvbnN0IHZhdWx0ID0gdGhpcy5hcHAudmF1bHQ7XHJcblxyXG4gICAgY29uc3Qgbm90ZXMgPSB0aGlzLnNldHRpbmdzLnJlbGF0aXZlUGF0aE9mRXhjbHVkZWROb3RlcyA9PT0gJycgPyB2YXVsdC5nZXRNYXJrZG93bkZpbGVzKCkgOiB2YXVsdC5nZXRNYXJrZG93bkZpbGVzKCkuZmlsdGVyKGZpbGUgPT4gIWZpbGUucGF0aC5pbmNsdWRlcyh0aGlzLnNldHRpbmdzLnJlbGF0aXZlUGF0aE9mRXhjbHVkZWROb3Rlcy50b1N0cmluZygpKSk7XHJcbiAgICBcclxuICAgIGNvbnN0IGV4aXN0aW5nQmlMaW5rcyA9IG5ldyBTZXQ8c3RyaW5nPigpO1xyXG5cclxuICAgIGZvciAoY29uc3Qgbm90ZSBvZiBub3Rlcykge1xyXG4gICAgICBjb25zdCBjb250ZW50ID0gYXdhaXQgdmF1bHQuY2FjaGVkUmVhZChub3RlKTtcclxuXHJcbiAgICAgIGNvbnN0IGJpTGlua0tleXdvcmRzID0gY29udGVudC5tYXRjaCgvXFxbXFxbKC4rPylcXF1cXF0vZykgfHwgW107XHJcblxyXG4gICAgICBmb3IgKGNvbnN0IGJpTGluayBvZiBiaUxpbmtLZXl3b3Jkcykge1xyXG4gICAgICAgIGNvbnN0IGtleXdvcmQgPSBiaUxpbmsuc2xpY2UoMiwgLTIpO1xyXG4gICAgICAgIGV4aXN0aW5nQmlMaW5rcy5hZGQoa2V5d29yZCk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBwb3RlbnRpYWxCaUxpbmtzID0gbmV3IE1hcDxzdHJpbmcsIG51bWJlcj4oKTtcclxuXHJcbiAgICBmb3IgKGNvbnN0IG5vdGUgb2Ygbm90ZXMpIHtcclxuICAgICAgY29uc3QgY29udGVudCA9IGF3YWl0IHZhdWx0LmNhY2hlZFJlYWQobm90ZSk7XHJcblxyXG4gICAgICBjb25zdCB1bmlxdWVLZXl3b3JkcyA9IGNvbnRlbnQubWF0Y2goL1xcYlxcdytcXGIvZykgfHwgW107XHJcblxyXG4gICAgICBmb3IgKGNvbnN0IGtleXdvcmQgb2YgdW5pcXVlS2V5d29yZHMpIHtcclxuICAgICAgICBpZiAoXHJcbiAgICAgICAgICAhcG90ZW50aWFsQmlMaW5rcy5oYXMoa2V5d29yZCkgJiZcclxuICAgICAgICAgICF0aGlzLnNldHRpbmdzLmJpTGlua3Muc29tZSgoYmlMaW5rKSA9PiBiaUxpbmsua2V5d29yZCA9PT0ga2V5d29yZCkgJiZcclxuICAgICAgICAgICFleGlzdGluZ0JpTGlua3MuaGFzKGtleXdvcmQpICYmXHJcbiAgICAgICAgICAhY29udGVudC5pbmNsdWRlcyhgW1ske2tleXdvcmR9XV1gKSAmJlxyXG4gICAgICAgICAgIXRoaXMuc2V0dGluZ3MuaWdub3JlZENvbnRlbnQuc29tZShcclxuICAgICAgICAgICAgKGlnbm9yZWRDb250ZW50KSA9PiBpZ25vcmVkQ29udGVudC5rZXl3b3JkID09PSBrZXl3b3JkXHJcbiAgICAgICAgICApXHJcbiAgICAgICAgKSB7XHJcbiAgICAgICAgICBwb3RlbnRpYWxCaUxpbmtzLnNldChrZXl3b3JkLCAxKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgcG90ZW50aWFsQmlMaW5rcy5zZXQoXHJcbiAgICAgICAgICAgIGtleXdvcmQsXHJcbiAgICAgICAgICAgIChwb3RlbnRpYWxCaUxpbmtzLmdldChrZXl3b3JkKSB8fCAwKSArIDFcclxuICAgICAgICAgICk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5zZXR0aW5ncy5iaUxpbmtzID0gQXJyYXkuZnJvbShwb3RlbnRpYWxCaUxpbmtzLmVudHJpZXMoKSkubWFwKFxyXG4gICAgICAoW2tleXdvcmQsIGNvdW50XSkgPT4gKHtcclxuICAgICAgICBrZXl3b3JkLFxyXG4gICAgICAgIGNvdW50LFxyXG4gICAgICAgIGlzU2VsZWN0ZWQ6IGZhbHNlLFxyXG4gICAgICB9KVxyXG4gICAgKTtcclxuXHJcbiAgICBhd2FpdCB0aGlzLnNhdmVTZXR0aW5ncygpO1xyXG5cclxuICAgIG5ldyBOb3RpY2UoJ1NlYXJjaCBmaW5pc2hlZCEnKTtcclxuICB9XHJcbn1cclxuXHJcbmNsYXNzIENvbnRlbnRMaW5rZXJTZXR0aW5nVGFiIGV4dGVuZHMgUGx1Z2luU2V0dGluZ1RhYiB7XHJcbiAgcGx1Z2luOiBDb250ZW50TGlua2VyUGx1Z2luO1xyXG5cclxuICBjb25zdHJ1Y3RvcihhcHA6IEFwcCwgcGx1Z2luOiBDb250ZW50TGlua2VyUGx1Z2luKSB7XHJcbiAgICBzdXBlcihhcHAsIHBsdWdpbik7XHJcbiAgICB0aGlzLnBsdWdpbiA9IHBsdWdpbjtcclxuICB9XHJcblxyXG4gIGFzeW5jIGRpc3BsYXkoKSB7XHJcblxyXG4gICAgY29uc3QgeyBjb250YWluZXJFbCB9ID0gdGhpcztcclxuXHJcbiAgICBjb250YWluZXJFbC5lbXB0eSgpO1xyXG5cclxuICAgIC8vIGNvbnRhaW5lckVsLmNyZWF0ZUVsKCdoMycsIHsgdGV4dDogJ0V4Y2x1ZGUgbm90ZXMgd2l0aCByZWxhdGl2ZSBwYXRoJyB9KTtcclxuICAgIGNvbnN0IHJlbGF0aXZlUGF0aEV4Y2x1c2lvbiA9IG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxyXG4gICAgICAuc2V0TmFtZSgnUmVsYXRpdmUgcGF0aCBvZiBleGNsdWRlZCBub3RlcycpXHJcbiAgICAgIC5zZXREZXNjKCdFbnRlciBhIHJlbGF0aXZlIHBhdGg6JylcclxuICAgIHJlbGF0aXZlUGF0aEV4Y2x1c2lvbi5hZGRUZXh0KGlucHV0ID0+IGlucHV0XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5zZXRQbGFjZWhvbGRlcignUmVsYXRpdmUgcGF0aCBvZiBleGx1ZGVkIG5vdGVzJylcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLnJlbGF0aXZlUGF0aE9mRXhjbHVkZWROb3Rlcy50b1N0cmluZygpKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MucmVsYXRpdmVQYXRoT2ZFeGNsdWRlZE5vdGVzID0gdmFsdWVcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkpXHJcblxyXG4gICAgY29uc3Qgc2VhcmNoQnV0dG9uID0gY29udGFpbmVyRWwuY3JlYXRlRWwoJ2J1dHRvbicsIHtcclxuICAgICAgdGV4dDogJ1NlYXJjaCBwb3NzaWJsZSBiaS1kaXJlY3Rpb25hbCBsaW5rcyBpbiB2YXVsdCcsXHJcbiAgICB9KTtcclxuICAgIHNlYXJjaEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGFzeW5jICgpID0+IHtcclxuICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2VhcmNoUG9zc2libGVCaUxpbmtzKCk7XHJcbiAgICAgIHRoaXMuZGlzcGxheSgpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXHJcbiAgICAgIC5zZXROYW1lKCdQb3NzaWJsZSBiaS1kaXJlY3Rpb25hbCBjb250ZW50JylcclxuICAgICAgLnNldERlc2MoJ0VudGVyIGEgbnVtYmVyOicpXHJcbiAgICAgIC5hZGRUZXh0KCh0ZXh0KSA9PlxyXG4gICAgICAgIHRleHRcclxuICAgICAgICAgIC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy5vcHRpb25zQ291bnQudG9TdHJpbmcoKSlcclxuICAgICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgcGFyc2VkVmFsdWUgPSBwYXJzZUZsb2F0KHZhbHVlKTtcclxuICAgICAgICAgICAgaWYgKCFpc05hTihwYXJzZWRWYWx1ZSkpIHtcclxuICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5vcHRpb25zQ291bnQgPSBwYXJzZWRWYWx1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfSlcclxuICAgICAgKTtcclxuXHJcbiAgICBjb25zdCBjb3VudEJ1dHRvbiA9IGNvbnRhaW5lckVsLmNyZWF0ZUVsKCdidXR0b24nLCB7XHJcbiAgICAgIHRleHQ6ICdVcGRhdGUgbnVtYmVyIG9mIHNlYXJjaCByZXN1bHRzJyxcclxuICAgIH0pO1xyXG4gICAgY291bnRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNlYXJjaFBvc3NpYmxlQmlMaW5rcygpO1xyXG4gICAgICB0aGlzLmRpc3BsYXkoKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGNvbnN0IHRhYmxlID0gY29udGFpbmVyRWwuY3JlYXRlRWwoJ3RhYmxlJywgeyBjbHM6ICdjb250ZW50LWxpbmtlci10YWJsZScgfSk7XHJcblxyXG4gICAgY29uc3QgdGhlYWQgPSB0YWJsZS5jcmVhdGVUSGVhZCgpO1xyXG4gICAgY29uc3QgaGVhZGVyUm93ID0gdGhlYWQuaW5zZXJ0Um93KCk7XHJcbiAgICBoZWFkZXJSb3cuaW5zZXJ0Q2VsbCgpLnRleHRDb250ZW50ID0gJ05vLic7XHJcbiAgICBoZWFkZXJSb3cuaW5zZXJ0Q2VsbCgpLnRleHRDb250ZW50ID0gJ0NvdW50JztcclxuICAgIGhlYWRlclJvdy5pbnNlcnRDZWxsKCkudGV4dENvbnRlbnQgPSAnS2V5d29yZCc7XHJcbiAgICBoZWFkZXJSb3cuaW5zZXJ0Q2VsbCgpLnRleHRDb250ZW50ID0gJ1NlbGVjdGVkJztcclxuXHJcbiAgICBjb25zdCBzb3J0ZWRCaUxpbmtzID0gdGhpcy5wbHVnaW4uc2V0dGluZ3MuYmlMaW5rc1xyXG4gICAgICAuc29ydCgoYSwgYikgPT4gYi5jb3VudCAtIGEuY291bnQpXHJcbiAgICAgIC5zbGljZSgwLCB0aGlzLnBsdWdpbi5zZXR0aW5ncy5vcHRpb25zQ291bnQpO1xyXG5cclxuICAgIGNvbnN0IHRib2R5ID0gdGFibGUuY3JlYXRlVEJvZHkoKTtcclxuICAgIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCBzb3J0ZWRCaUxpbmtzLmxlbmd0aDsgaW5kZXgrKykge1xyXG4gICAgICBjb25zdCB7IGtleXdvcmQsIGNvdW50LCBpc1NlbGVjdGVkIH0gPSBzb3J0ZWRCaUxpbmtzW2luZGV4XTtcclxuXHJcbiAgICAgIGNvbnN0IGlzQWxyZWFkeUJpTGluayA9IGF3YWl0IHRoaXMuaXNBbHJlYWR5QmlMaW5rKGtleXdvcmQpO1xyXG5cclxuICAgICAgaWYgKCFpc0FscmVhZHlCaUxpbmsgJiYgIXRoaXMuaXNJZ25vcmVkKGtleXdvcmQpKSB7XHJcbiAgICAgICAgY29uc3Qgcm93ID0gdGJvZHkuaW5zZXJ0Um93KCk7XHJcbiAgICAgICAgcm93Lmluc2VydENlbGwoKS50ZXh0Q29udGVudCA9IChpbmRleCArIDEpLnRvU3RyaW5nKCk7XHJcbiAgICAgICAgcm93Lmluc2VydENlbGwoKS50ZXh0Q29udGVudCA9IGNvdW50LnRvU3RyaW5nKCk7XHJcbiAgICAgICAgcm93Lmluc2VydENlbGwoKS50ZXh0Q29udGVudCA9IGtleXdvcmQ7XHJcbiAgICAgICAgcm93Lmluc2VydENlbGwoKS5hcHBlbmRDaGlsZCh0aGlzLmNyZWF0ZUNoZWNrYm94KGtleXdvcmQsIGlzU2VsZWN0ZWQpKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHVwZGF0ZUJ1dHRvbiA9IGNvbnRhaW5lckVsLmNyZWF0ZUVsKCdidXR0b24nLCB7XHJcbiAgICAgIHRleHQ6ICdVcGRhdGUgYmktZGlyZWN0aW9uYWwgbGluayBmb3Igc2VsZWN0ZWQgb3B0aW9uKHMpJyxcclxuICAgIH0pO1xyXG4gICAgdXBkYXRlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBhd2FpdCB0aGlzLnVwZGF0ZUJpTGlua3MoKTtcclxuICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2VhcmNoUG9zc2libGVCaUxpbmtzKCk7XHJcbiAgICAgIHRoaXMuZGlzcGxheSgpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgY29uc3QgaWdub3JlQnV0dG9uID0gY29udGFpbmVyRWwuY3JlYXRlRWwoJ2J1dHRvbicsIHtcclxuICAgICAgdGV4dDogJ0lnbm9yZSBzZWxlY3RlZCBvcHRpb24ocyknLFxyXG4gICAgfSk7XHJcbiAgICBpZ25vcmVCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGF3YWl0IHRoaXMuaWdub3JlU2VsZWN0ZWRPcHRpb25zKCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICB0aGlzLmRpc3BsYXlJZ25vcmVkQ29udGVudExpc3QoKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIENoZWNrIGlmIGEga2V5d29yZCBpcyBpZ25vcmVkLlxyXG4gICAqIEBwYXJhbSBrZXl3b3JkIC0gVGhlIGtleXdvcmQgdG8gY2hlY2suXHJcbiAgICogQHJldHVybnMgVHJ1ZSBpZiBpZ25vcmVkLCBmYWxzZSBvdGhlcndpc2UuXHJcbiAgICovXHJcbiAgaXNJZ25vcmVkKGtleXdvcmQ6IHN0cmluZyk6IGJvb2xlYW4ge1xyXG4gICAgcmV0dXJuIHRoaXMucGx1Z2luLnNldHRpbmdzLmlnbm9yZWRDb250ZW50LnNvbWUoXHJcbiAgICAgIChpZ25vcmVkQ29udGVudCkgPT4gaWdub3JlZENvbnRlbnQua2V5d29yZCA9PT0ga2V5d29yZFxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIENoZWNrIGlmIGEga2V5d29yZCBpcyBhbHJlYWR5IGEgYmktbGluayBpbiBhbnkgbm90ZS5cclxuICAgKiBAcGFyYW0ga2V5d29yZCAtIFRoZSBrZXl3b3JkIHRvIGNoZWNrLlxyXG4gICAqIEByZXR1cm5zIFRydWUgaWYgaXQgaXMgYWxyZWFkeSBhIGJpLWxpbmssIGZhbHNlIG90aGVyd2lzZS5cclxuICAgKi9cclxuICBhc3luYyBpc0FscmVhZHlCaUxpbmsoa2V5d29yZDogc3RyaW5nKTogUHJvbWlzZTxib29sZWFuPiB7XHJcbiAgICBjb25zdCB2YXVsdCA9IHRoaXMucGx1Z2luLmFwcC52YXVsdDtcclxuICAgIGNvbnN0IG5vdGVzID0gdmF1bHQuZ2V0TWFya2Rvd25GaWxlcygpO1xyXG5cclxuICAgIGZvciAoY29uc3Qgbm90ZSBvZiBub3Rlcykge1xyXG4gICAgICBjb25zdCBjb250ZW50ID0gYXdhaXQgdmF1bHQuY2FjaGVkUmVhZChub3RlKTtcclxuXHJcbiAgICAgIGNvbnN0IHJlZ2V4ID0gbmV3IFJlZ0V4cChgXFxcXFtcXFxcWyR7a2V5d29yZH1cXFxcXVxcXFxdYCwgJ2cnKTtcclxuICAgICAgaWYgKGNvbnRlbnQubWF0Y2gocmVnZXgpKSB7XHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gZmFsc2U7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBDcmVhdGUgYSBjaGVja2JveCBlbGVtZW50IGZvciBhIGJpLWxpbmsgb3B0aW9uLlxyXG4gICAqIEBwYXJhbSBrZXl3b3JkIC0gVGhlIGtleXdvcmQgZm9yIHRoZSBiaS1saW5rLlxyXG4gICAqIEBwYXJhbSBjaGVja2VkIC0gV2hldGhlciB0aGUgY2hlY2tib3ggaXMgc2VsZWN0ZWQuXHJcbiAgICogQHJldHVybnMgVGhlIGNyZWF0ZWQgY2hlY2tib3ggZWxlbWVudC5cclxuICAgKi9cclxuICBjcmVhdGVDaGVja2JveChrZXl3b3JkOiBzdHJpbmcsIGNoZWNrZWQ6IGJvb2xlYW4pOiBIVE1MRWxlbWVudCB7XHJcbiAgICBjb25zdCBjaGVja2JveENvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xhYmVsJyk7XHJcbiAgICBjb25zdCBjaGVja2JveCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lucHV0Jyk7XHJcbiAgICBjaGVja2JveC50eXBlID0gJ2NoZWNrYm94JztcclxuICAgIGNoZWNrYm94LmNoZWNrZWQgPSBjaGVja2VkO1xyXG4gICAgY2hlY2tib3hDb250YWluZXIuYXBwZW5kQ2hpbGQoY2hlY2tib3gpO1xyXG5cclxuICAgIGNoZWNrYm94LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIGFzeW5jICgpID0+IHtcclxuICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MuYmlMaW5rcyA9IHRoaXMucGx1Z2luLnNldHRpbmdzLmJpTGlua3MubWFwKChiaUxpbmspID0+XHJcbiAgICAgICAgYmlMaW5rLmtleXdvcmQgPT09IGtleXdvcmRcclxuICAgICAgICAgID8geyAuLi5iaUxpbmssIGlzU2VsZWN0ZWQ6IGNoZWNrYm94LmNoZWNrZWQgfVxyXG4gICAgICAgICAgOiBiaUxpbmtcclxuICAgICAgKTtcclxuXHJcbiAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgcmV0dXJuIGNoZWNrYm94Q29udGFpbmVyO1xyXG4gIH1cclxuXHJcbiAgYXN5bmMgdXBkYXRlQmlMaW5rcygpIHtcclxuICAgIGNvbnN0IHNlbGVjdGVkQmlMaW5rcyA9IHRoaXMucGx1Z2luLnNldHRpbmdzLmJpTGlua3MuZmlsdGVyKFxyXG4gICAgICAoYmlMaW5rKSA9PiBiaUxpbmsuaXNTZWxlY3RlZFxyXG4gICAgKTtcclxuICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmJpTGlua3MgPSB0aGlzLnBsdWdpbi5zZXR0aW5ncy5iaUxpbmtzLm1hcCgoYmlMaW5rKSA9PlxyXG4gICAgICBzZWxlY3RlZEJpTGlua3Muc29tZSgoeyBrZXl3b3JkIH0pID0+IGJpTGluay5rZXl3b3JkID09PSBrZXl3b3JkKVxyXG4gICAgICAgID8geyAuLi5iaUxpbmssIGlzU2VsZWN0ZWQ6IGZhbHNlIH1cclxuICAgICAgICA6IGJpTGlua1xyXG4gICAgKTtcclxuICBcclxuICAgIC8vIERpc3BsYXkgdGhlIGluaXRpYWwgcHJvZ3Jlc3Mgbm90aWNlXHJcbiAgICBsZXQgcHJvZ3Jlc3NOb3RpY2UgPSBuZXcgTm90aWNlKCdVcGRhdGluZzogMCBvZiAwJyk7XHJcbiAgXHJcbiAgICAvLyBGdW5jdGlvbiB0byB1cGRhdGUgdGhlIHByb2dyZXNzIG5vdGljZVxyXG4gICAgY29uc3QgdXBkYXRlUHJvZ3Jlc3NOb3RpY2UgPSAoY3VycmVudDogbnVtYmVyLCB0b3RhbDogbnVtYmVyKSA9PiB7XHJcbiAgICAgIGNvbnN0IG1lc3NhZ2UgPSBgVXBkYXRpbmc6ICR7Y3VycmVudH0gb2YgJHt0b3RhbH1gO1xyXG4gICAgICBwcm9ncmVzc05vdGljZS5zZXRNZXNzYWdlKG1lc3NhZ2UpO1xyXG4gICAgfTtcclxuICBcclxuICAgIC8vIFNpbXVsYXRlIGFuIGFzeW5jaHJvbm91cyBvcGVyYXRpb24gdXNpbmcgc2V0VGltZW91dFxyXG4gICAgYXdhaXQgbmV3IFByb21pc2U8dm9pZD4oKHJlc29sdmUpID0+IHtcclxuICAgICAgY29uc3QgZGVsYXkgPSAobXM6IG51bWJlcikgPT5cclxuICAgICAgICBuZXcgUHJvbWlzZSgocmVzKSA9PiBzZXRUaW1lb3V0KHJlcywgbXMpKTtcclxuICBcclxuICAgICAgY29uc3QgdXBkYXRlTG9vcCA9IGFzeW5jICgpID0+IHtcclxuICAgICAgICBjb25zdCB2YXVsdCA9IHRoaXMucGx1Z2luLmFwcC52YXVsdDtcclxuICAgICAgICBjb25zdCBub3RlcyA9IHZhdWx0LmdldE1hcmtkb3duRmlsZXMoKTtcclxuICAgICAgICBjb25zdCB0b3RhbE5vdGVzID0gbm90ZXMubGVuZ3RoO1xyXG4gICAgICAgIGxldCBpID0gMDtcclxuICBcclxuICAgICAgICBmb3IgKGNvbnN0IHNlbGVjdGVkQmlMaW5rIG9mIHNlbGVjdGVkQmlMaW5rcykge1xyXG4gICAgICAgICAgY29uc3QgeyBrZXl3b3JkIH0gPSBzZWxlY3RlZEJpTGluaztcclxuICBcclxuICAgICAgICAgIGZvciAoY29uc3Qgbm90ZSBvZiBub3Rlcykge1xyXG4gICAgICAgICAgICBpZiAoIXRoaXMuaXNFeGNsdWRlZChub3RlLnBhdGgpKSB7XHJcbiAgICAgICAgICAgICAgbGV0IGNvbnRlbnQgPSBhd2FpdCB2YXVsdC5yZWFkKG5vdGUpO1xyXG4gIFxyXG4gICAgICAgICAgICAgIGNvbnN0IHJlZ2V4ID0gbmV3IFJlZ0V4cChcclxuICAgICAgICAgICAgICAgIGBcXFxcYiR7a2V5d29yZC5yZXBsYWNlKC9bLS9cXFxcXiQqKz8uKCl8W1xcXXt9XS9nLCAnXFxcXCQmJyl9XFxcXGJgLFxyXG4gICAgICAgICAgICAgICAgJ2cnXHJcbiAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgICBjb250ZW50ID0gY29udGVudC5yZXBsYWNlKHJlZ2V4LCBgW1ske2tleXdvcmR9XV1gKTtcclxuICBcclxuICAgICAgICAgICAgICBhd2FpdCB2YXVsdC5tb2RpZnkobm90ZSwgY29udGVudCk7XHJcbiAgXHJcbiAgICAgICAgICAgICAgaSsrO1xyXG4gICAgICAgICAgICAgIC8vIFVwZGF0ZSBwcm9ncmVzcyBub3RpY2VcclxuICAgICAgICAgICAgICB1cGRhdGVQcm9ncmVzc05vdGljZShpLCB0b3RhbE5vdGVzKTtcclxuICAgICAgICAgICAgICBhd2FpdCBkZWxheSgxKTsgLy8gQWxsb3cgVUkgdG8gdXBkYXRlXHJcbiAgXHJcbiAgICAgICAgICAgICAgaWYgKGkgJSAxMDAgPT0gMCkge1xyXG4gICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgIG5ldyBOb3RpY2UocHJvZ3Jlc3NOb3RpY2Uubm90aWNlRWwuZ2V0VGV4dCgpKTtcclxuICAgICAgICAgICAgICAgIH0sIDMwMDApO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICBcclxuICAgICAgICByZXNvbHZlKCk7XHJcbiAgICAgIH07XHJcbiAgXHJcbiAgICAgIHVwZGF0ZUxvb3AoKTtcclxuICAgIH0pO1xyXG4gIFxyXG4gICAgLy8gQ2xvc2UgdGhlIHByb2dyZXNzIG5vdGljZVxyXG4gICAgcHJvZ3Jlc3NOb3RpY2UuaGlkZSgpO1xyXG5cclxuICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xyXG4gIFxyXG4gICAgLy8gYXdhaXQgdGhpcy5zYXZlRGF0YVRvVmF1bHQoKTtcclxuICAgIG5ldyBOb3RpY2UoJ1VwZGF0ZSBmaW5pc2hlZCEnKTtcclxuICB9XHJcbiAgXHJcbiAgLyoqXHJcbiAgICogQ2hlY2sgaWYgYSBub3RlIHBhdGggaXMgZXhjbHVkZWQuXHJcbiAgICogQHBhcmFtIHBhdGggLSBUaGUgcGF0aCBvZiB0aGUgbm90ZS5cclxuICAgKiBAcmV0dXJucyBUcnVlIGlmIHRoZSBub3RlIHBhdGggaXMgZXhjbHVkZWQsIGZhbHNlIG90aGVyd2lzZS5cclxuICAgKi9cclxuICBpc0V4Y2x1ZGVkKHBhdGg6IHN0cmluZyk6IGJvb2xlYW4ge1xyXG4gICAgaWYgKHRoaXMucGx1Z2luLnNldHRpbmdzLnJlbGF0aXZlUGF0aE9mRXhjbHVkZWROb3RlcyA9PT0gJycpIHJldHVybiBmYWxzZTtcclxuICBcclxuICAgIHJldHVybiBwYXRoLmluY2x1ZGVzKHRoaXMucGx1Z2luLnNldHRpbmdzLnJlbGF0aXZlUGF0aE9mRXhjbHVkZWROb3Rlcy50b1N0cmluZygpKTtcclxuICB9XHJcbiAgXHJcbiAgLyoqXHJcbiAgICogSWdub3JlIHRoZSBzZWxlY3RlZCBiaS1saW5rIG9wdGlvbnMuXHJcbiAgICovXHJcbiAgYXN5bmMgaWdub3JlU2VsZWN0ZWRPcHRpb25zKCkge1xyXG4gICAgY29uc3Qgc2VsZWN0ZWRPcHRpb25zID0gdGhpcy5wbHVnaW4uc2V0dGluZ3MuYmlMaW5rcy5maWx0ZXIoXHJcbiAgICAgIChiaUxpbmspID0+IGJpTGluay5pc1NlbGVjdGVkXHJcbiAgICApO1xyXG5cclxuICAgIGZvciAoY29uc3Qgc2VsZWN0ZWRPcHRpb24gb2Ygc2VsZWN0ZWRPcHRpb25zKSB7XHJcbiAgICAgIGNvbnN0IHsga2V5d29yZCB9ID0gc2VsZWN0ZWRPcHRpb247XHJcbiAgICAgIC8vIHNldCB0aGUgaXNTZWxlY3RlZCBzdGF0dXMgdG8gZmFsc2VcclxuICAgICAgc2VsZWN0ZWRPcHRpb24uaXNTZWxlY3RlZCA9IGZhbHNlO1xyXG5cclxuICAgICAgLy8gYWRkIHNlbGVjdGVkIG9wdGlvbnMgdG8gaWdub3JlZCBsaXN0XHJcbiAgICAgIGlmIChcclxuICAgICAgICAhdGhpcy5wbHVnaW4uc2V0dGluZ3MuaWdub3JlZENvbnRlbnQuc29tZShcclxuICAgICAgICAgIChpZ25vcmVkQ29udGVudCkgPT4gaWdub3JlZENvbnRlbnQua2V5d29yZCA9PT0ga2V5d29yZFxyXG4gICAgICAgIClcclxuICAgICAgKSB7XHJcbiAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MuaWdub3JlZENvbnRlbnQucHVzaChzZWxlY3RlZE9wdGlvbik7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvLyBSZW1vdmUgdGhlIHNlbGVjdGVkIG9wdGlvbnMgZnJvbSB0aGUgYmktbGlua3MgYXJyYXlcclxuICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmJpTGlua3MgPSB0aGlzLnBsdWdpbi5zZXR0aW5ncy5iaUxpbmtzLmZpbHRlcihcclxuICAgICAgKGJpTGluaykgPT4gIWJpTGluay5pc1NlbGVjdGVkXHJcbiAgICApO1xyXG5cclxuICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xyXG5cclxuICAgIGF3YWl0IHRoaXMucGx1Z2luLnNlYXJjaFBvc3NpYmxlQmlMaW5rcygpO1xyXG4gICAgdGhpcy5kaXNwbGF5KCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBEaXNwbGF5IHRoZSBpZ25vcmVkIGNvbnRlbnQgbGlzdC5cclxuICAgKi9cclxuICBhc3luYyBkaXNwbGF5SWdub3JlZENvbnRlbnRMaXN0KCkge1xyXG4gICAgY29uc3QgeyBjb250YWluZXJFbCB9ID0gdGhpcztcclxuXHJcbiAgICBjb25zdCBpZ25vcmVkQ29udGVudFNldHRpbmcgPSBuZXcgU2V0dGluZyhjb250YWluZXJFbClcclxuICAgICAgLnNldE5hbWUoJ0lnbm9yZWQgY29udGVudCBsaXN0JylcclxuICAgICAgLnNldERlc2MoJ0tleXdvcmRzIHRoYXQgeW91IHdhbnQgdG8gaWdub3JlJyk7XHJcblxyXG4gICAgY29uc3QgaWdub3JlZENvbnRlbnRUYWJsZSA9IGNvbnRhaW5lckVsLmNyZWF0ZUVsKCd0YWJsZScsIHtcclxuICAgICAgY2xzOiAnY29udGVudC1saW5rZXItaWdub3JlZC1jb250ZW50LXRhYmxlJyxcclxuICAgIH0pO1xyXG5cclxuICAgIGNvbnN0IGlnbm9yZWRDb250ZW50VGhlYWQgPSBpZ25vcmVkQ29udGVudFRhYmxlLmNyZWF0ZVRIZWFkKCk7XHJcbiAgICBjb25zdCBpZ25vcmVkQ29udGVudEhlYWRlclJvdyA9IGlnbm9yZWRDb250ZW50VGhlYWQuaW5zZXJ0Um93KCk7XHJcbiAgICBpZ25vcmVkQ29udGVudEhlYWRlclJvdy5pbnNlcnRDZWxsKCkudGV4dENvbnRlbnQgPSAnTm8uJztcclxuICAgIGlnbm9yZWRDb250ZW50SGVhZGVyUm93Lmluc2VydENlbGwoKS50ZXh0Q29udGVudCA9ICdDb3VudCc7XHJcbiAgICBpZ25vcmVkQ29udGVudEhlYWRlclJvdy5pbnNlcnRDZWxsKCkudGV4dENvbnRlbnQgPSAnS2V5d29yZCc7XHJcbiAgICBpZ25vcmVkQ29udGVudEhlYWRlclJvdy5pbnNlcnRDZWxsKCkudGV4dENvbnRlbnQgPSAnU2VsZWN0ZWQnO1xyXG5cclxuICAgIGNvbnN0IHNvcnRlZElnbm9yZWRMaXN0ID0gdGhpcy5wbHVnaW4uc2V0dGluZ3MuaWdub3JlZENvbnRlbnQuc29ydChcclxuICAgICAgKGEsIGIpID0+IGIuY291bnQgLSBhLmNvdW50XHJcbiAgICApO1xyXG5cclxuICAgIGNvbnN0IGlnbm9yZWRDb250ZW50VGJvZHkgPSBpZ25vcmVkQ29udGVudFRhYmxlLmNyZWF0ZVRCb2R5KCk7XHJcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHNvcnRlZElnbm9yZWRMaXN0Lmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgIGNvbnN0IHsga2V5d29yZCwgY291bnQsIGlzU2VsZWN0ZWQgfSA9IHNvcnRlZElnbm9yZWRMaXN0W2ldO1xyXG5cclxuICAgICAgY29uc3Qgcm93ID0gaWdub3JlZENvbnRlbnRUYm9keS5pbnNlcnRSb3coKTtcclxuICAgICAgcm93Lmluc2VydENlbGwoMCkudGV4dENvbnRlbnQgPSAoaSArIDEpLnRvU3RyaW5nKCk7XHJcbiAgICAgIHJvdy5pbnNlcnRDZWxsKDEpLnRleHRDb250ZW50ID0gY291bnQgPyBjb3VudC50b1N0cmluZygpIDogJyc7XHJcbiAgICAgIHJvdy5pbnNlcnRDZWxsKDIpLnRleHRDb250ZW50ID0ga2V5d29yZDtcclxuICAgICAgcm93Lmluc2VydENlbGwoMykuYXBwZW5kQ2hpbGQoXHJcbiAgICAgICAgdGhpcy5jcmVhdGVJZ25vcmVkQ2hlY2tib3goa2V5d29yZCwgaXNTZWxlY3RlZClcclxuICAgICAgKTtcclxuICAgIH1cclxuXHJcbiAgICBjb250YWluZXJFbC5hcHBlbmRDaGlsZChpZ25vcmVkQ29udGVudFRhYmxlKTtcclxuXHJcbiAgICBjb25zdCByZW1vdmVCdXR0b24gPSBjb250YWluZXJFbC5jcmVhdGVFbCgnYnV0dG9uJywge1xyXG4gICAgICB0ZXh0OiAnUmVtb3ZlIHNlbGVjdGVkIG9wdGlvbihzKSBmcm9tIGlnbm9yZWQgY29udGVudCBsaXN0JyxcclxuICAgIH0pO1xyXG4gICAgcmVtb3ZlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAvLyBSZW1vdmUgdGhlIHNlbGVjdGVkIG9wdGlvbnMgZnJvbSB0aGUgaWdub3JlZCBjb250ZW50IGxpc3RcclxuICAgICAgdGhpcy5yZW1vdmVGcm9tSWdub3JlZExpc3QoKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQ3JlYXRlIGEgY2hlY2tib3ggZWxlbWVudCBmb3IgYW4gaWdub3JlZCBvcHRpb24uXHJcbiAgICogQHBhcmFtIGtleXdvcmQgLSBUaGUga2V5d29yZCBmb3IgdGhlIGlnbm9yZWQgb3B0aW9uLlxyXG4gICAqIEBwYXJhbSBjaGVja2VkIC0gV2hldGhlciB0aGUgY2hlY2tib3ggaXMgc2VsZWN0ZWQuXHJcbiAgICogQHJldHVybnMgVGhlIGNyZWF0ZWQgY2hlY2tib3ggZWxlbWVudC5cclxuICAgKi9cclxuICBjcmVhdGVJZ25vcmVkQ2hlY2tib3goa2V5d29yZDogc3RyaW5nLCBjaGVja2VkOiBib29sZWFuKTogSFRNTEVsZW1lbnQge1xyXG4gICAgY29uc3QgY2hlY2tib3hDb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsYWJlbCcpO1xyXG4gICAgY29uc3QgY2hlY2tib3ggPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbnB1dCcpO1xyXG4gICAgY2hlY2tib3gudHlwZSA9ICdjaGVja2JveCc7XHJcbiAgICBjaGVja2JveC5jaGVja2VkID0gY2hlY2tlZDtcclxuICAgIGNoZWNrYm94Q29udGFpbmVyLmFwcGVuZENoaWxkKGNoZWNrYm94KTtcclxuXHJcbiAgICBjaGVja2JveC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmlnbm9yZWRDb250ZW50ID0gdGhpcy5wbHVnaW4uc2V0dGluZ3MuaWdub3JlZENvbnRlbnQubWFwKFxyXG4gICAgICAgIChpZ25vcmVkQ29udGVudCkgPT5cclxuICAgICAgICAgIGlnbm9yZWRDb250ZW50LmtleXdvcmQgPT09IGtleXdvcmRcclxuICAgICAgICAgICAgPyB7IC4uLmlnbm9yZWRDb250ZW50LCBpc1NlbGVjdGVkOiBjaGVja2JveC5jaGVja2VkIH1cclxuICAgICAgICAgICAgOiBpZ25vcmVkQ29udGVudFxyXG4gICAgICApO1xyXG5cclxuICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICByZXR1cm4gY2hlY2tib3hDb250YWluZXI7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZW1vdmUgdGhlIHNlbGVjdGVkIG9wdGlvbnMgZnJvbSB0aGUgaWdub3JlZCBjb250ZW50IGxpc3QuXHJcbiAgICovXHJcbiAgYXN5bmMgcmVtb3ZlRnJvbUlnbm9yZWRMaXN0KCkge1xyXG4gICAgLy8gR2V0IHNlbGVjdGVkIGlnbm9yZWQgb3B0aW9uc1xyXG4gICAgY29uc3Qgc2VsZWN0ZWRJZ25vcmVkT3B0aW9ucyA9IHRoaXMucGx1Z2luLnNldHRpbmdzLmlnbm9yZWRDb250ZW50LmZpbHRlcihcclxuICAgICAgKGlnbm9yZWRDb250ZW50KSA9PiB7XHJcbiAgICAgICAgcmV0dXJuIGlnbm9yZWRDb250ZW50LmlzU2VsZWN0ZWQ7XHJcbiAgICAgIH1cclxuICAgICk7XHJcblxyXG4gICAgZm9yIChjb25zdCBzZWxlY3RlZElnbm9yZWRPcHRpb24gb2Ygc2VsZWN0ZWRJZ25vcmVkT3B0aW9ucykge1xyXG4gICAgICBjb25zdCB7IGtleXdvcmQgfSA9IHNlbGVjdGVkSWdub3JlZE9wdGlvbjtcclxuXHJcbiAgICAgIC8vIFJlbW92ZSBmcm9tIGlnbm9yZWQgY29udGVudCBsaXN0XHJcbiAgICAgIGNvbnN0IGluZGV4ID0gdGhpcy5wbHVnaW4uc2V0dGluZ3MuaWdub3JlZENvbnRlbnQuZmluZEluZGV4KFxyXG4gICAgICAgIChpZ25vcmVkQ29udGVudCkgPT4gaWdub3JlZENvbnRlbnQua2V5d29yZCA9PT0ga2V5d29yZFxyXG4gICAgICApO1xyXG4gICAgICBpZiAoaW5kZXggIT09IC0xKSB7XHJcbiAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MuaWdub3JlZENvbnRlbnQuc3BsaWNlKGluZGV4LCAxKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xyXG5cclxuICAgIHRoaXMuZGlzcGxheSgpOyAvLyBSZWZyZXNoIHRoZSBpZ25vcmVkIGNvbnRlbnQgbGlzdFxyXG4gIH1cclxufVxyXG4iXSwKICAibWFwcGluZ3MiOiAiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUEsc0JBQStEO0FBcUIvRCxJQUFxQixzQkFBckIsY0FBaUQsdUJBQU87QUFBQTtBQUFBO0FBQUE7QUFBQSxFQU90RCxNQUFNLFNBQVM7QUFDYixVQUFNLEtBQUssYUFBYTtBQUV4QixZQUFRLElBQUksK0JBQStCO0FBRTNDLFNBQUssV0FBVztBQUFBLE1BQ2QsSUFBSTtBQUFBLE1BQ0osTUFBTTtBQUFBLE1BQ04sVUFBVSxZQUFZO0FBQ3BCLGNBQU0sS0FBSyxzQkFBc0I7QUFDakMsY0FBTSxLQUFLLGFBQWE7QUFBQSxNQUMxQjtBQUFBLElBQ0YsQ0FBQztBQUVELFNBQUssY0FBYyxJQUFJLHdCQUF3QixLQUFLLEtBQUssSUFBSSxDQUFDO0FBQUEsRUFDaEU7QUFBQTtBQUFBO0FBQUE7QUFBQSxFQUtBLE1BQU0sZUFBZTtBQUNuQixTQUFLLFdBQVcsT0FBTztBQUFBLE1BQ3JCLENBQUM7QUFBQSxNQUNEO0FBQUEsUUFDRSxTQUFTLENBQUM7QUFBQSxRQUNWLGNBQWM7QUFBQSxRQUNkLGdCQUFnQixDQUFDO0FBQUEsUUFDakIsNkJBQTZCO0FBQUEsTUFDL0I7QUFBQSxNQUNBLE1BQU0sS0FBSyxTQUFTO0FBQUEsSUFDdEI7QUFBQSxFQUNGO0FBQUE7QUFBQTtBQUFBO0FBQUEsRUFLQSxNQUFNLGVBQWU7QUFDbkIsU0FBSyxTQUFTLEtBQUssUUFBUTtBQUFBLEVBQzdCO0FBQUE7QUFBQTtBQUFBO0FBQUEsRUFLQSxNQUFNLHdCQUF3QjtBQUM1QixVQUFNLFFBQVEsS0FBSyxJQUFJO0FBRXZCLFVBQU0sUUFBUSxLQUFLLFNBQVMsZ0NBQWdDLEtBQUssTUFBTSxpQkFBaUIsSUFBSSxNQUFNLGlCQUFpQixFQUFFLE9BQU8sVUFBUSxDQUFDLEtBQUssS0FBSyxTQUFTLEtBQUssU0FBUyw0QkFBNEIsU0FBUyxDQUFDLENBQUM7QUFFN00sVUFBTSxrQkFBa0Isb0JBQUksSUFBWTtBQUV4QyxlQUFXLFFBQVEsT0FBTztBQUN4QixZQUFNLFVBQVUsTUFBTSxNQUFNLFdBQVcsSUFBSTtBQUUzQyxZQUFNLGlCQUFpQixRQUFRLE1BQU0sZ0JBQWdCLEtBQUssQ0FBQztBQUUzRCxpQkFBVyxVQUFVLGdCQUFnQjtBQUNuQyxjQUFNLFVBQVUsT0FBTyxNQUFNLEdBQUcsRUFBRTtBQUNsQyx3QkFBZ0IsSUFBSSxPQUFPO0FBQUEsTUFDN0I7QUFBQSxJQUNGO0FBRUEsVUFBTSxtQkFBbUIsb0JBQUksSUFBb0I7QUFFakQsZUFBVyxRQUFRLE9BQU87QUFDeEIsWUFBTSxVQUFVLE1BQU0sTUFBTSxXQUFXLElBQUk7QUFFM0MsWUFBTSxpQkFBaUIsUUFBUSxNQUFNLFVBQVUsS0FBSyxDQUFDO0FBRXJELGlCQUFXLFdBQVcsZ0JBQWdCO0FBQ3BDLFlBQ0UsQ0FBQyxpQkFBaUIsSUFBSSxPQUFPLEtBQzdCLENBQUMsS0FBSyxTQUFTLFFBQVEsS0FBSyxDQUFDLFdBQVcsT0FBTyxZQUFZLE9BQU8sS0FDbEUsQ0FBQyxnQkFBZ0IsSUFBSSxPQUFPLEtBQzVCLENBQUMsUUFBUSxTQUFTLEtBQUssV0FBVyxLQUNsQyxDQUFDLEtBQUssU0FBUyxlQUFlO0FBQUEsVUFDNUIsQ0FBQyxtQkFBbUIsZUFBZSxZQUFZO0FBQUEsUUFDakQsR0FDQTtBQUNBLDJCQUFpQixJQUFJLFNBQVMsQ0FBQztBQUFBLFFBQ2pDLE9BQU87QUFDTCwyQkFBaUI7QUFBQSxZQUNmO0FBQUEsYUFDQyxpQkFBaUIsSUFBSSxPQUFPLEtBQUssS0FBSztBQUFBLFVBQ3pDO0FBQUEsUUFDRjtBQUFBLE1BQ0Y7QUFBQSxJQUNGO0FBRUEsU0FBSyxTQUFTLFVBQVUsTUFBTSxLQUFLLGlCQUFpQixRQUFRLENBQUMsRUFBRTtBQUFBLE1BQzdELENBQUMsQ0FBQyxTQUFTLEtBQUssT0FBTztBQUFBLFFBQ3JCO0FBQUEsUUFDQTtBQUFBLFFBQ0EsWUFBWTtBQUFBLE1BQ2Q7QUFBQSxJQUNGO0FBRUEsVUFBTSxLQUFLLGFBQWE7QUFFeEIsUUFBSSx1QkFBTyxrQkFBa0I7QUFBQSxFQUMvQjtBQUNGO0FBRUEsSUFBTSwwQkFBTixjQUFzQyxpQ0FBaUI7QUFBQSxFQUdyRCxZQUFZLEtBQVUsUUFBNkI7QUFDakQsVUFBTSxLQUFLLE1BQU07QUFDakIsU0FBSyxTQUFTO0FBQUEsRUFDaEI7QUFBQSxFQUVBLE1BQU0sVUFBVTtBQUVkLFVBQU0sRUFBRSxZQUFZLElBQUk7QUFFeEIsZ0JBQVksTUFBTTtBQUdsQixVQUFNLHdCQUF3QixJQUFJLHdCQUFRLFdBQVcsRUFDbEQsUUFBUSxpQ0FBaUMsRUFDekMsUUFBUSx3QkFBd0I7QUFDbkMsMEJBQXNCLFFBQVEsV0FBUyxNQUNOLGVBQWUsZ0NBQWdDLEVBQy9DLFNBQVMsS0FBSyxPQUFPLFNBQVMsNEJBQTRCLFNBQVMsQ0FBQyxFQUNwRSxTQUFTLE9BQU8sVUFBVTtBQUN6QixXQUFLLE9BQU8sU0FBUyw4QkFBOEI7QUFDbkQsWUFBTSxLQUFLLE9BQU8sYUFBYTtBQUFBLElBQ2pDLENBQUMsQ0FBQztBQUVsQyxVQUFNLGVBQWUsWUFBWSxTQUFTLFVBQVU7QUFBQSxNQUNsRCxNQUFNO0FBQUEsSUFDUixDQUFDO0FBQ0QsaUJBQWEsaUJBQWlCLFNBQVMsWUFBWTtBQUNqRCxZQUFNLEtBQUssT0FBTyxzQkFBc0I7QUFDeEMsV0FBSyxRQUFRO0FBQUEsSUFDZixDQUFDO0FBRUQsUUFBSSx3QkFBUSxXQUFXLEVBQ3BCLFFBQVEsaUNBQWlDLEVBQ3pDLFFBQVEsaUJBQWlCLEVBQ3pCO0FBQUEsTUFBUSxDQUFDLFNBQ1IsS0FDRyxTQUFTLEtBQUssT0FBTyxTQUFTLGFBQWEsU0FBUyxDQUFDLEVBQ3JELFNBQVMsT0FBTyxVQUFVO0FBQ3pCLGNBQU0sY0FBYyxXQUFXLEtBQUs7QUFDcEMsWUFBSSxDQUFDLE1BQU0sV0FBVyxHQUFHO0FBQ3ZCLGVBQUssT0FBTyxTQUFTLGVBQWU7QUFBQSxRQUN0QztBQUFBLE1BQ0YsQ0FBQztBQUFBLElBQ0w7QUFFRixVQUFNLGNBQWMsWUFBWSxTQUFTLFVBQVU7QUFBQSxNQUNqRCxNQUFNO0FBQUEsSUFDUixDQUFDO0FBQ0QsZ0JBQVksaUJBQWlCLFNBQVMsWUFBWTtBQUNoRCxZQUFNLEtBQUssT0FBTyxzQkFBc0I7QUFDeEMsV0FBSyxRQUFRO0FBQUEsSUFDZixDQUFDO0FBRUQsVUFBTSxRQUFRLFlBQVksU0FBUyxTQUFTLEVBQUUsS0FBSyx1QkFBdUIsQ0FBQztBQUUzRSxVQUFNLFFBQVEsTUFBTSxZQUFZO0FBQ2hDLFVBQU0sWUFBWSxNQUFNLFVBQVU7QUFDbEMsY0FBVSxXQUFXLEVBQUUsY0FBYztBQUNyQyxjQUFVLFdBQVcsRUFBRSxjQUFjO0FBQ3JDLGNBQVUsV0FBVyxFQUFFLGNBQWM7QUFDckMsY0FBVSxXQUFXLEVBQUUsY0FBYztBQUVyQyxVQUFNLGdCQUFnQixLQUFLLE9BQU8sU0FBUyxRQUN4QyxLQUFLLENBQUMsR0FBRyxNQUFNLEVBQUUsUUFBUSxFQUFFLEtBQUssRUFDaEMsTUFBTSxHQUFHLEtBQUssT0FBTyxTQUFTLFlBQVk7QUFFN0MsVUFBTSxRQUFRLE1BQU0sWUFBWTtBQUNoQyxhQUFTLFFBQVEsR0FBRyxRQUFRLGNBQWMsUUFBUSxTQUFTO0FBQ3pELFlBQU0sRUFBRSxTQUFTLE9BQU8sV0FBVyxJQUFJLGNBQWMsS0FBSztBQUUxRCxZQUFNLGtCQUFrQixNQUFNLEtBQUssZ0JBQWdCLE9BQU87QUFFMUQsVUFBSSxDQUFDLG1CQUFtQixDQUFDLEtBQUssVUFBVSxPQUFPLEdBQUc7QUFDaEQsY0FBTSxNQUFNLE1BQU0sVUFBVTtBQUM1QixZQUFJLFdBQVcsRUFBRSxlQUFlLFFBQVEsR0FBRyxTQUFTO0FBQ3BELFlBQUksV0FBVyxFQUFFLGNBQWMsTUFBTSxTQUFTO0FBQzlDLFlBQUksV0FBVyxFQUFFLGNBQWM7QUFDL0IsWUFBSSxXQUFXLEVBQUUsWUFBWSxLQUFLLGVBQWUsU0FBUyxVQUFVLENBQUM7QUFBQSxNQUN2RTtBQUFBLElBQ0Y7QUFFQSxVQUFNLGVBQWUsWUFBWSxTQUFTLFVBQVU7QUFBQSxNQUNsRCxNQUFNO0FBQUEsSUFDUixDQUFDO0FBQ0QsaUJBQWEsaUJBQWlCLFNBQVMsWUFBWTtBQUNqRCxZQUFNLEtBQUssY0FBYztBQUN6QixZQUFNLEtBQUssT0FBTyxzQkFBc0I7QUFDeEMsV0FBSyxRQUFRO0FBQUEsSUFDZixDQUFDO0FBRUQsVUFBTSxlQUFlLFlBQVksU0FBUyxVQUFVO0FBQUEsTUFDbEQsTUFBTTtBQUFBLElBQ1IsQ0FBQztBQUNELGlCQUFhLGlCQUFpQixTQUFTLFlBQVk7QUFDakQsWUFBTSxLQUFLLHNCQUFzQjtBQUFBLElBQ25DLENBQUM7QUFFRCxTQUFLLDBCQUEwQjtBQUFBLEVBQ2pDO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBLEVBT0EsVUFBVSxTQUEwQjtBQUNsQyxXQUFPLEtBQUssT0FBTyxTQUFTLGVBQWU7QUFBQSxNQUN6QyxDQUFDLG1CQUFtQixlQUFlLFlBQVk7QUFBQSxJQUNqRDtBQUFBLEVBQ0Y7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUEsRUFPQSxNQUFNLGdCQUFnQixTQUFtQztBQUN2RCxVQUFNLFFBQVEsS0FBSyxPQUFPLElBQUk7QUFDOUIsVUFBTSxRQUFRLE1BQU0saUJBQWlCO0FBRXJDLGVBQVcsUUFBUSxPQUFPO0FBQ3hCLFlBQU0sVUFBVSxNQUFNLE1BQU0sV0FBVyxJQUFJO0FBRTNDLFlBQU0sUUFBUSxJQUFJLE9BQU8sU0FBUyxpQkFBaUIsR0FBRztBQUN0RCxVQUFJLFFBQVEsTUFBTSxLQUFLLEdBQUc7QUFDeEIsZUFBTztBQUFBLE1BQ1Q7QUFBQSxJQUNGO0FBRUEsV0FBTztBQUFBLEVBQ1Q7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQSxFQVFBLGVBQWUsU0FBaUIsU0FBK0I7QUFDN0QsVUFBTSxvQkFBb0IsU0FBUyxjQUFjLE9BQU87QUFDeEQsVUFBTSxXQUFXLFNBQVMsY0FBYyxPQUFPO0FBQy9DLGFBQVMsT0FBTztBQUNoQixhQUFTLFVBQVU7QUFDbkIsc0JBQWtCLFlBQVksUUFBUTtBQUV0QyxhQUFTLGlCQUFpQixVQUFVLFlBQVk7QUFDOUMsV0FBSyxPQUFPLFNBQVMsVUFBVSxLQUFLLE9BQU8sU0FBUyxRQUFRO0FBQUEsUUFBSSxDQUFDLFdBQy9ELE9BQU8sWUFBWSxVQUNmLEVBQUUsR0FBRyxRQUFRLFlBQVksU0FBUyxRQUFRLElBQzFDO0FBQUEsTUFDTjtBQUVBLFlBQU0sS0FBSyxPQUFPLGFBQWE7QUFBQSxJQUNqQyxDQUFDO0FBRUQsV0FBTztBQUFBLEVBQ1Q7QUFBQSxFQUVBLE1BQU0sZ0JBQWdCO0FBQ3BCLFVBQU0sa0JBQWtCLEtBQUssT0FBTyxTQUFTLFFBQVE7QUFBQSxNQUNuRCxDQUFDLFdBQVcsT0FBTztBQUFBLElBQ3JCO0FBQ0EsU0FBSyxPQUFPLFNBQVMsVUFBVSxLQUFLLE9BQU8sU0FBUyxRQUFRO0FBQUEsTUFBSSxDQUFDLFdBQy9ELGdCQUFnQixLQUFLLENBQUMsRUFBRSxRQUFRLE1BQU0sT0FBTyxZQUFZLE9BQU8sSUFDNUQsRUFBRSxHQUFHLFFBQVEsWUFBWSxNQUFNLElBQy9CO0FBQUEsSUFDTjtBQUdBLFFBQUksaUJBQWlCLElBQUksdUJBQU8sa0JBQWtCO0FBR2xELFVBQU0sdUJBQXVCLENBQUMsU0FBaUIsVUFBa0I7QUFDL0QsWUFBTSxVQUFVLGFBQWEsY0FBYztBQUMzQyxxQkFBZSxXQUFXLE9BQU87QUFBQSxJQUNuQztBQUdBLFVBQU0sSUFBSSxRQUFjLENBQUMsWUFBWTtBQUNuQyxZQUFNLFFBQVEsQ0FBQyxPQUNiLElBQUksUUFBUSxDQUFDLFFBQVEsV0FBVyxLQUFLLEVBQUUsQ0FBQztBQUUxQyxZQUFNLGFBQWEsWUFBWTtBQUM3QixjQUFNLFFBQVEsS0FBSyxPQUFPLElBQUk7QUFDOUIsY0FBTSxRQUFRLE1BQU0saUJBQWlCO0FBQ3JDLGNBQU0sYUFBYSxNQUFNO0FBQ3pCLFlBQUksSUFBSTtBQUVSLG1CQUFXLGtCQUFrQixpQkFBaUI7QUFDNUMsZ0JBQU0sRUFBRSxRQUFRLElBQUk7QUFFcEIscUJBQVcsUUFBUSxPQUFPO0FBQ3hCLGdCQUFJLENBQUMsS0FBSyxXQUFXLEtBQUssSUFBSSxHQUFHO0FBQy9CLGtCQUFJLFVBQVUsTUFBTSxNQUFNLEtBQUssSUFBSTtBQUVuQyxvQkFBTSxRQUFRLElBQUk7QUFBQSxnQkFDaEIsTUFBTSxRQUFRLFFBQVEseUJBQXlCLE1BQU07QUFBQSxnQkFDckQ7QUFBQSxjQUNGO0FBQ0Esd0JBQVUsUUFBUSxRQUFRLE9BQU8sS0FBSyxXQUFXO0FBRWpELG9CQUFNLE1BQU0sT0FBTyxNQUFNLE9BQU87QUFFaEM7QUFFQSxtQ0FBcUIsR0FBRyxVQUFVO0FBQ2xDLG9CQUFNLE1BQU0sQ0FBQztBQUViLGtCQUFJLElBQUksT0FBTyxHQUFHO0FBQ2hCLDJCQUFXLE1BQU07QUFDZixzQkFBSSx1QkFBTyxlQUFlLFNBQVMsUUFBUSxDQUFDO0FBQUEsZ0JBQzlDLEdBQUcsR0FBSTtBQUFBLGNBQ1Q7QUFBQSxZQUNGO0FBQUEsVUFDRjtBQUFBLFFBQ0Y7QUFFQSxnQkFBUTtBQUFBLE1BQ1Y7QUFFQSxpQkFBVztBQUFBLElBQ2IsQ0FBQztBQUdELG1CQUFlLEtBQUs7QUFFcEIsVUFBTSxLQUFLLE9BQU8sYUFBYTtBQUcvQixRQUFJLHVCQUFPLGtCQUFrQjtBQUFBLEVBQy9CO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBLEVBT0EsV0FBVyxNQUF1QjtBQUNoQyxRQUFJLEtBQUssT0FBTyxTQUFTLGdDQUFnQztBQUFJLGFBQU87QUFFcEUsV0FBTyxLQUFLLFNBQVMsS0FBSyxPQUFPLFNBQVMsNEJBQTRCLFNBQVMsQ0FBQztBQUFBLEVBQ2xGO0FBQUE7QUFBQTtBQUFBO0FBQUEsRUFLQSxNQUFNLHdCQUF3QjtBQUM1QixVQUFNLGtCQUFrQixLQUFLLE9BQU8sU0FBUyxRQUFRO0FBQUEsTUFDbkQsQ0FBQyxXQUFXLE9BQU87QUFBQSxJQUNyQjtBQUVBLGVBQVcsa0JBQWtCLGlCQUFpQjtBQUM1QyxZQUFNLEVBQUUsUUFBUSxJQUFJO0FBRXBCLHFCQUFlLGFBQWE7QUFHNUIsVUFDRSxDQUFDLEtBQUssT0FBTyxTQUFTLGVBQWU7QUFBQSxRQUNuQyxDQUFDLG1CQUFtQixlQUFlLFlBQVk7QUFBQSxNQUNqRCxHQUNBO0FBQ0EsYUFBSyxPQUFPLFNBQVMsZUFBZSxLQUFLLGNBQWM7QUFBQSxNQUN6RDtBQUFBLElBQ0Y7QUFHQSxTQUFLLE9BQU8sU0FBUyxVQUFVLEtBQUssT0FBTyxTQUFTLFFBQVE7QUFBQSxNQUMxRCxDQUFDLFdBQVcsQ0FBQyxPQUFPO0FBQUEsSUFDdEI7QUFFQSxVQUFNLEtBQUssT0FBTyxhQUFhO0FBRS9CLFVBQU0sS0FBSyxPQUFPLHNCQUFzQjtBQUN4QyxTQUFLLFFBQVE7QUFBQSxFQUNmO0FBQUE7QUFBQTtBQUFBO0FBQUEsRUFLQSxNQUFNLDRCQUE0QjtBQUNoQyxVQUFNLEVBQUUsWUFBWSxJQUFJO0FBRXhCLFVBQU0sd0JBQXdCLElBQUksd0JBQVEsV0FBVyxFQUNsRCxRQUFRLHNCQUFzQixFQUM5QixRQUFRLGtDQUFrQztBQUU3QyxVQUFNLHNCQUFzQixZQUFZLFNBQVMsU0FBUztBQUFBLE1BQ3hELEtBQUs7QUFBQSxJQUNQLENBQUM7QUFFRCxVQUFNLHNCQUFzQixvQkFBb0IsWUFBWTtBQUM1RCxVQUFNLDBCQUEwQixvQkFBb0IsVUFBVTtBQUM5RCw0QkFBd0IsV0FBVyxFQUFFLGNBQWM7QUFDbkQsNEJBQXdCLFdBQVcsRUFBRSxjQUFjO0FBQ25ELDRCQUF3QixXQUFXLEVBQUUsY0FBYztBQUNuRCw0QkFBd0IsV0FBVyxFQUFFLGNBQWM7QUFFbkQsVUFBTSxvQkFBb0IsS0FBSyxPQUFPLFNBQVMsZUFBZTtBQUFBLE1BQzVELENBQUMsR0FBRyxNQUFNLEVBQUUsUUFBUSxFQUFFO0FBQUEsSUFDeEI7QUFFQSxVQUFNLHNCQUFzQixvQkFBb0IsWUFBWTtBQUM1RCxhQUFTLElBQUksR0FBRyxJQUFJLGtCQUFrQixRQUFRLEtBQUs7QUFDakQsWUFBTSxFQUFFLFNBQVMsT0FBTyxXQUFXLElBQUksa0JBQWtCLENBQUM7QUFFMUQsWUFBTSxNQUFNLG9CQUFvQixVQUFVO0FBQzFDLFVBQUksV0FBVyxDQUFDLEVBQUUsZUFBZSxJQUFJLEdBQUcsU0FBUztBQUNqRCxVQUFJLFdBQVcsQ0FBQyxFQUFFLGNBQWMsUUFBUSxNQUFNLFNBQVMsSUFBSTtBQUMzRCxVQUFJLFdBQVcsQ0FBQyxFQUFFLGNBQWM7QUFDaEMsVUFBSSxXQUFXLENBQUMsRUFBRTtBQUFBLFFBQ2hCLEtBQUssc0JBQXNCLFNBQVMsVUFBVTtBQUFBLE1BQ2hEO0FBQUEsSUFDRjtBQUVBLGdCQUFZLFlBQVksbUJBQW1CO0FBRTNDLFVBQU0sZUFBZSxZQUFZLFNBQVMsVUFBVTtBQUFBLE1BQ2xELE1BQU07QUFBQSxJQUNSLENBQUM7QUFDRCxpQkFBYSxpQkFBaUIsU0FBUyxZQUFZO0FBRWpELFdBQUssc0JBQXNCO0FBQUEsSUFDN0IsQ0FBQztBQUFBLEVBQ0g7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQSxFQVFBLHNCQUFzQixTQUFpQixTQUErQjtBQUNwRSxVQUFNLG9CQUFvQixTQUFTLGNBQWMsT0FBTztBQUN4RCxVQUFNLFdBQVcsU0FBUyxjQUFjLE9BQU87QUFDL0MsYUFBUyxPQUFPO0FBQ2hCLGFBQVMsVUFBVTtBQUNuQixzQkFBa0IsWUFBWSxRQUFRO0FBRXRDLGFBQVMsaUJBQWlCLFVBQVUsWUFBWTtBQUM5QyxXQUFLLE9BQU8sU0FBUyxpQkFBaUIsS0FBSyxPQUFPLFNBQVMsZUFBZTtBQUFBLFFBQ3hFLENBQUMsbUJBQ0MsZUFBZSxZQUFZLFVBQ3ZCLEVBQUUsR0FBRyxnQkFBZ0IsWUFBWSxTQUFTLFFBQVEsSUFDbEQ7QUFBQSxNQUNSO0FBRUEsWUFBTSxLQUFLLE9BQU8sYUFBYTtBQUFBLElBQ2pDLENBQUM7QUFFRCxXQUFPO0FBQUEsRUFDVDtBQUFBO0FBQUE7QUFBQTtBQUFBLEVBS0EsTUFBTSx3QkFBd0I7QUFFNUIsVUFBTSx5QkFBeUIsS0FBSyxPQUFPLFNBQVMsZUFBZTtBQUFBLE1BQ2pFLENBQUMsbUJBQW1CO0FBQ2xCLGVBQU8sZUFBZTtBQUFBLE1BQ3hCO0FBQUEsSUFDRjtBQUVBLGVBQVcseUJBQXlCLHdCQUF3QjtBQUMxRCxZQUFNLEVBQUUsUUFBUSxJQUFJO0FBR3BCLFlBQU0sUUFBUSxLQUFLLE9BQU8sU0FBUyxlQUFlO0FBQUEsUUFDaEQsQ0FBQyxtQkFBbUIsZUFBZSxZQUFZO0FBQUEsTUFDakQ7QUFDQSxVQUFJLFVBQVUsSUFBSTtBQUNoQixhQUFLLE9BQU8sU0FBUyxlQUFlLE9BQU8sT0FBTyxDQUFDO0FBQUEsTUFDckQ7QUFBQSxJQUNGO0FBRUEsVUFBTSxLQUFLLE9BQU8sYUFBYTtBQUUvQixTQUFLLFFBQVE7QUFBQSxFQUNmO0FBQ0Y7IiwKICAibmFtZXMiOiBbXQp9Cg==
